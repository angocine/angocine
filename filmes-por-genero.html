<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ANGOCINE - Filmes por Gênero</title>

  <style>
    body { margin:0; background:#001f3f; color:#fff; font-family:Arial; }
    .topo { background:#00264d; padding:15px; text-align:center; font-size:18px; }
    .lista-filmes {
      padding:15px; display:flex; flex-wrap:wrap;
      gap:15px; justify-content:center;
    }
    .card {
      background:#00264d; width:160px; border-radius:12px;
      overflow:hidden; cursor:pointer; transition:.2s;
    }
    .card:hover { transform:scale(1.05); }
    .card img { width:100%; height:220px; object-fit:cover; }
    .card p { text-align:center; padding:8px; margin:0; }
  </style>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

</head>
<body>

<div class="topo" id="titulo"></div>

<div class="lista-filmes" id="lista"></div>

<script>
  /* FIREBASE */
  const firebaseConfig = {
    apiKey: "AIzaSyC_5YYEx899qVIDbMguMigD3Zq0CSIWg-U",
    authDomain: "paineladminfilmes.firebaseapp.com",
    projectId: "paineladminfilmes",
    storageBucket: "paineladminfilmes.firebasestorage.app",
    messagingSenderId: "76091758574",
    appId: "1:76091758574:web:6aca9167578d2a5d2e20ff"
  };

  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();

  const colecoes = ["filmes", "series", "animes", "doramas"];

  const params = new URLSearchParams(window.location.search);
  const genero = params.get("genero");
  document.getElementById("titulo").textContent = "Gênero: " + genero;

  async function carregarFilmes() {
    const lista = document.getElementById("lista");

    for (let col of colecoes) {
      const snap = await db.collection(col).get();

      snap.forEach(doc => {
        const item = doc.data();

        if (!item.genero) return;

        let generosArray = item.genero.split(",").map(g => g.trim());

        if (!generosArray.includes(genero)) return;

        // Descobrir página
        const pagina =
          col === "filmes" ? "filme.html" :
          col === "series" ? "serie.html" :
          col === "animes" ? "anime.html" :
          "dorama.html";

        // Criar card
        const card = document.createElement("div");
        card.className = "card";

        card.innerHTML = `
          <img src="${item.imagem}">
          <p>${item.titulo}</p>
        `;

        card.onclick = () => {
          window.location.href = `${pagina}?slug=${item.slug}`;
        };

        lista.appendChild(card);
      });
    }
  }

  carregarFilmes();
</script>

</body>
</html>