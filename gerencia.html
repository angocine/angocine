<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ANGOCINE | Painel ADM</title>

<style>
:root{
  --bg:#001f3f;
  --sidebar:#00264d;
  --panel:#0a2b4d;
  --card:#0f3a6f;
  --accent:#ffcc00;
  --danger:#ff4444;
  --success:#00cc44;
  --text:#e5e7eb;
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:Arial,sans-serif;
  background:var(--bg);
  color:var(--text);
}

/* LAYOUT */
.layout{display:flex;min-height:100vh}
.sidebar{
  width:240px;
  background:var(--sidebar);
  padding:20px;
}
.sidebar h2{
  text-align:center;
  color:var(--accent);
  margin-bottom:30px;
}
.sidebar a{
  display:block;
  padding:12px;
  margin-bottom:10px;
  border-radius:8px;
  text-decoration:none;
  color:white;
  background:#003366;
  font-weight:bold;
}
.sidebar a:hover{background:#004c99}

.main{flex:1;padding:25px}

/* DASHBOARD */
.stats{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(180px,1fr));
  gap:15px;
  margin-bottom:25px;
}
.card{
  background:var(--card);
  padding:18px;
  border-radius:12px;
}
.card b{
  font-size:28px;
  color:var(--accent);
}

/* PANEL */
.panel{
  background:var(--panel);
  padding:20px;
  border-radius:12px;
}
input,textarea{
  width:100%;
  max-width:400px;
  padding:10px;
  border-radius:8px;
  border:none;
  margin-bottom:10px;
}
table{
  width:100%;
  border-collapse:collapse;
  margin-top:15px;
}
th,td{
  padding:12px;
  border-bottom:1px solid #003f6f;
}
button{
  padding:6px 12px;
  border:none;
  border-radius:6px;
  font-weight:bold;
  cursor:pointer;
}
.edit{background:#ffaa00}
.del{background:var(--danger);color:white}

/* MODAL */
#modal{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.85);
  display:none;
  justify-content:center;
  align-items:center;
  padding:10px;
}
.modal-box{
  background:var(--sidebar);
  width:100%;
  max-width:520px;
  padding:20px;
  border-radius:12px;
}
.temporada{
  background:var(--card);
  padding:10px;
  border-radius:10px;
  margin-top:10px;
}
.temporada-header{
  display:flex;
  justify-content:space-between;
  font-weight:bold;
  color:var(--accent);
}
.episodio{
  display:flex;
  gap:8px;
  margin-top:6px;
}
.ep-label{min-width:100px}
.ep-input{flex:1}
</style>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
</head>

<body>

<div class="layout">

  <!-- SIDEBAR -->
  <div class="sidebar">
    <h2>ANGOCINE</h2>
    <a href="adm.html">‚ûï Adicionar</a>
    <a href="#" onclick="abrirGerenciador()">üìÇ Gerenciar</a>
    <a href="usuario.html">üë§ Usu√°rios</a>
    <a href="home.html">üè† Home</a>
  </div>

  <!-- MAIN -->
  <div class="main">

    <!-- DASHBOARD -->
    <div class="stats">
      <div class="card">üì¶ Total<br><b id="totalPub">0</b></div>
      <div class="card">üé¨ Filmes<br><b id="totalFilmes">0</b></div>
      <div class="card">üì∫ S√©ries<br><b id="totalSeries">0</b></div>
      <div class="card">üéå Animes<br><b id="totalAnimes">0</b></div>
      <div class="card">üá∞üá∑ Doramas<br><b id="totalDoramas">0</b></div>
    </div>

    <!-- GERENCIAR -->
    <div class="panel" id="gerenciar" style="display:none">
      <h2>Gerenciar Conte√∫do</h2>
      <input id="buscar" placeholder="Pesquisar..." oninput="filtrar()">

      <table>
        <thead>
          <tr>
            <th>T√≠tulo</th>
            <th>Tipo</th>
            <th>Cliques</th>
            <th>A√ß√µes</th>
          </tr>
        </thead>
        <tbody id="lista"></tbody>
      </table>
    </div>

  </div>
</div>

<!-- MODAL -->
<div id="modal">
  <div class="modal-box">
    <h3>Editar Conte√∫do</h3>
    <input id="editTitulo" placeholder="T√≠tulo">
    <input id="editAno" type="number" placeholder="Ano">
    <input id="editGenero" placeholder="G√™nero">
    <input id="editImagem" placeholder="Imagem URL">
    <textarea id="editDescricao" placeholder="Descri√ß√£o"></textarea>
    <input id="editLink" placeholder="Link (filmes)">

    <div id="editTemporadas"></div>

    <button onclick="salvarEdicao()" style="background:var(--success);width:100%;margin-top:10px">
      Salvar
    </button>
  </div>
</div>

<script>
// FIREBASE (TEU ‚Äì SEM ALTERA√á√ïES)
const firebaseConfig={
  apiKey:"AIzaSyC_5YYEx899qVIDbMguMigD3Zq0CSIWg-U",
  authDomain:"paineladminfilmes.firebaseapp.com",
  projectId:"paineladminfilmes",
  storageBucket:"paineladminfilmes.firebasestorage.app",
  messagingSenderId:"76091758574",
  appId:"1:76091758574:web:6aca9167578d2a5d2e20ff"
};
firebase.initializeApp(firebaseConfig);
const db=firebase.firestore();

// COLE√á√ïES
const colecoes=["filmes","series","animes","doramas"];
let dados=[],editando=null;

// ABRIR GERENCIADOR
async function abrirGerenciador(){
  document.getElementById("gerenciar").style.display="block";
  dados=[];
  let tot=0,f=0,s=0,a=0,d=0;

  for(let c of colecoes){
    const snap=await db.collection(c).get();
    snap.forEach(doc=>{
      const x=doc.data();
      dados.push({id:doc.id,tipo:c,...x});
      tot++;
      if(c==="filmes")f++;
      if(c==="series")s++;
      if(c==="animes")a++;
      if(c==="doramas")d++;
    });
  }

  totalPub.innerText=tot;
  totalFilmes.innerText=f;
  totalSeries.innerText=s;
  totalAnimes.innerText=a;
  totalDoramas.innerText=d;

  exibir(dados);
}

// LISTAR
function exibir(arr){
  lista.innerHTML="";
  arr.forEach(i=>{
    lista.innerHTML+=`
    <tr>
      <td>${i.titulo}</td>
      <td>${i.tipo}</td>
      <td>${i.clics||0}</td>
      <td>
        <button class="edit" onclick="editar('${i.id}','${i.tipo}')">Editar</button>
        <button class="del" onclick="apagar('${i.id}','${i.tipo}')">X</button>
      </td>
    </tr>`;
  });
}

// FILTRO
function filtrar(){
  const t=buscar.value.toLowerCase();
  exibir(dados.filter(d=>d.titulo.toLowerCase().includes(t)));
}

// APAGAR
async function apagar(id,tipo){
  if(confirm("Apagar conte√∫do?")){
    await db.collection(tipo).doc(id).delete();
    abrirGerenciador();
  }
}

// EDITAR
function editar(id,tipo){
  editando={id,tipo};
  const i=dados.find(x=>x.id===id&&x.tipo===tipo);
  editTitulo.value=i.titulo||"";
  editAno.value=i.ano||"";
  editGenero.value=i.genero||"";
  editImagem.value=i.imagem||"";
  editDescricao.value=i.descricao||"";
  editLink.value=i.link||"";
  modal.style.display="flex";
}

// SALVAR
async function salvarEdicao(){
  const obj={
    titulo:editTitulo.value,
    ano:+editAno.value||null,
    genero:editGenero.value,
    imagem:editImagem.value,
    descricao:editDescricao.value,
    link:editLink.value
  };
  await db.collection(editando.tipo).doc(editando.id).update(obj);
  modal.style.display="none";
  abrirGerenciador();
}
</script>

</body>
</html>